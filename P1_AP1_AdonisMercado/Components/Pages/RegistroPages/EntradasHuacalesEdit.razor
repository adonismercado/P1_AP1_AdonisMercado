@page "/EntradasHuacales/Edit/{IdEntrada:int}"
@inject EntradaHuacalesService entradaHuacalesService
@inject NavigationManager navigationManager
@rendermode InteractiveServer

<PageTitle>Editar Entrada de Huacal</PageTitle>
<EditForm Model="EntradasHuacales" OnValidSubmit="Guardar" FormName="EditEntradaHuacal">
	<DataAnnotationsValidator/>

	<div class="container">
		<div class="card-header text-center">
			<h5 class="card-title">Editar Entrada de Huacal</h5>
		</div>

		<div class="card-body">
			<div class="mb-3">
				<label class="form-label">IdEntrada</label>
				<InputNumber class="form-control" @bind-Value="EntradasHuacales.IdEntrada"></InputNumber>
				<ValidationMessage For="(() => EntradasHuacales.IdEntrada)"/>
			</div>

			<div class="mb-3">
				<label class="form-label">NombreCliente</label>
				<InputText class="form-control" @bind-Value="EntradasHuacales.NombreCliente"></InputText>
				<ValidationMessage For="(() => EntradasHuacales.NombreCliente)"/>
			</div>

			<div class="mb-3">
				<label class="form-label">Cantidad</label>
				<InputNumber class="form-control" @bind-Value="EntradasHuacales.Cantidad"></InputNumber>
				<ValidationMessage For="(() => EntradasHuacales.Cantidad)"/>
			</div>

			<div class="mb-3">
				<label class="form-label">Precio</label>
				<InputNumber class="form-control" @bind-Value="EntradasHuacales.Precio"></InputNumber>
				<ValidationMessage For="(() => EntradasHuacales.Precio)"/>
			</div>

			<div class="mb-3">
				<label class="form-label">Fecha</label>
				<InputDate class="form-control" @bind-Value="EntradasHuacales.Fecha"></InputDate>
				<ValidationMessage For="(() => EntradasHuacales.Fecha)"/>
			</div>

			@if (!string.IsNullOrWhiteSpace(errorMensaje))
			{
				<div class="alert alert-danger">@errorMensaje</div>
			}
		</div>

		<div class="card-footer text-center">
			<a href="/EntradasHuacales/Index" class="btn btn-secondary">
				<span class="bi bi-arrow-left"></span> Volver	
			</a>

			<button type="submit" class="btn btn-primary bi bi-save"> Guardar</button>
			<buttton type="button" class="btn btn-danger bi bi-trash" @onclick="Eliminar"> Eliminar</buttton>
		</div>
	</div>
</EditForm>

@code {
	[Parameter]
	public int IdEntrada { get; set; }

	public EntradasHuacales EntradasHuacales { get; set; } = new EntradasHuacales();
	public string errorMensaje { get; set; } = string.Empty;

	protected override async Task OnInitializedAsync()
	{
		if (IdEntrada > 0)
		{
			EntradasHuacales = await entradaHuacalesService.Buscar(IdEntrada);
		}
	}

	public async Task Guardar()
	{
		var modificado = await entradaHuacalesService.Guardar(EntradasHuacales);

		if (modificado)
		{
			navigationManager.NavigateTo("/EntradasHuacales/Index");
		}
		else
		{
			errorMensaje = "No se pudo modificar la entrada correctamente.";
		}
	}

	public async Task Eliminar()
	{
		var eliminado = await entradaHuacalesService.Eliminar(IdEntrada);

		if (eliminado)
		{
			navigationManager.NavigateTo("EntradasHuacales/Index");
		}
		else
		{
			errorMensaje = "No se pudo eliminar la entrada correctamente.";
		}
	}
}
